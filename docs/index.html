<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Do-Jjeon-Coo | 두쫀쿠 (Live)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Kakao Map SDK (Services 라이브러리 포함 필수) -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ff09b5f692fad0cbbb8e690ace21f9c7&libraries=services"></script>
    
    <!-- Google AdSense (아래 주석을 해제하고 ca-pub- 뒤에 본인의 게시자 ID를 넣으세요) -->
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2863619342768324"
     crossorigin="anonymous"></script>
   
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .gradient-text {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        #map {
            width: 100%;
            height: 500px;
            border-radius: 12px;
            z-index: 10;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800 flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
                <i class="fa-solid fa-utensils text-blue-600 text-2xl"></i>
                <h1 class="text-2xl font-bold tracking-tight text-slate-900">두쫀쿠 <span class="text-xs text-blue-500 font-normal border border-blue-200 rounded px-1">Live Web</span></h1>
            </div>
            <a href="https://github.com/Yong009/do-jjeon-coo" target="_blank" class="text-slate-500 hover:text-blue-600 transition">
                <i class="fa-brands fa-github text-2xl"></i>
            </a>
        </div>
    </header>

    <main class="flex-grow">
        <!-- Search Section -->
        <section class="bg-white border-b border-slate-200 pb-8 pt-8">
            <div class="max-w-4xl mx-auto px-4 text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-4">
                    실시간 <span class="gradient-text">지역 검색</span>
                </h2>
                <!-- 가로/세로 반응형 검색창 -->
                <div class="bg-white p-2 rounded-2xl md:rounded-full shadow-lg border border-slate-200 flex flex-col md:flex-row max-w-xl mx-auto items-center gap-2 md:gap-0">
                    <!-- City Select -->
                    <select id="citySelect" onchange="updateDistricts()" class="w-full md:w-auto bg-transparent px-4 py-3 outline-none text-slate-700 cursor-pointer font-medium border-b md:border-b-0 md:border-r border-slate-200 text-center md:text-left">
                        <option value="서울">서울</option>
                        <option value="대구">대구</option>
                    </select>

                    <!-- District Select -->
                    <select id="districtSelect" class="w-full md:w-auto flex-grow bg-transparent px-4 py-3 outline-none text-slate-700 cursor-pointer font-medium min-w-[100px] text-center md:text-left">
                        <!-- Populated by JS -->
                    </select>

                    <button onclick="searchPlaces()" class="w-full md:w-auto bg-blue-600 text-white rounded-xl md:rounded-full px-8 py-3 font-semibold hover:bg-blue-700 transition flex items-center justify-center gap-2">
                        <i class="fa-solid fa-search"></i>
                        <span>탐색</span>
                    </button>
                </div>
                <p class="text-xs text-slate-400 mt-3">* "선택 지역 + 두쫀쿠" 키워드로 검색된 결과를 표시합니다.</p>
            </div>
        </section>

        <!-- AdFit Banner Area (카카오 애드핏) -->
        <div id="kakao-adfit" class="max-w-7xl mx-auto px-4 mt-4 text-center">
            <!-- PC용 (모바일에서 숨김) -->
            <div class="hidden md:block">
                <ins class="kakao_ad_area" style="display:none;"
                    data-ad-unit = "DAN-zFTiVOIXW666h4R5"
                    data-ad-width = "728"
                    data-ad-height = "90"></ins>
            </div>
            <!-- 모바일용 Placeholder (추후 모바일용 ID 발급 시 교체) -->
            <!-- 모바일용 (PC에서 숨김) -->
            <div class="block md:hidden">
                <ins class="kakao_ad_area" style="display:none;"
                    data-ad-unit = "DAN-A3VyptE0YrQylD3y"
                    data-ad-width = "320"
                    data-ad-height = "100"></ins>
            </div>
            
            <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
        </div>

        <!-- Coupang Partners New Banner (상단 배치) -->
        <div id="coupang-search-widget" class="max-w-7xl mx-auto px-4 mt-4 text-center">
            <iframe src="https://link.coupang.com/a/dE9KeZ" width="100%" height="75" frameborder="0" scrolling="no" referrerpolicy="unsafe-url" browsingtopics></iframe>
            <p class="text-[10px] text-slate-400 mt-1">이 포스팅은 쿠팡 파트너스 활동의 일환으로, 이에 따른 일정액의 수수료를 제공받습니다.</p>
        </div>

        <!-- Map & List Section -->
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex flex-col md:flex-row gap-6 h-full">
            
            <!-- Map (Mobile: Top, Desktop: Left) -->
            <div class="w-full md:w-1/2 h-full">
                <div id="map" class="shadow-md h-[300px] md:h-[500px]"></div>
            </div>

            <!-- List (Mobile: Bottom, Desktop: Right) -->
            <div class="w-full md:w-1/2 flex flex-col h-[500px]">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-slate-900">검색 결과 <span id="resultCount" class="text-blue-600 ml-1 text-base">0</span></h3>
                    <div class="text-sm text-slate-500">실시간 데이터</div>
                </div>
                
                <div id="loading" class="hidden text-center py-10">
                    <i class="fa-solid fa-circle-notch fa-spin text-blue-500 text-3xl"></i>
                    <p class="mt-2 text-slate-500">정보를 찾아오는 중입니다...</p>
                </div>

                <div id="placeList" class="flex-1 overflow-y-auto pr-2 space-y-3 pb-4">
                    <!-- Javascript will inject items here -->
                    <div class="text-center py-20 bg-slate-50 rounded-lg border border-dashed border-slate-300">
                        <p class="text-slate-400">지역을 선택하고 검색 버튼을 눌러보세요!</p>
                    </div>
                </div>
            </div>
        </section>
        </section>

        <!-- Original Coupang Carousel (하단 이동) -->
        <div id="coupang-partners-carousel" class="max-w-7xl mx-auto px-4 py-6 text-center border-t border-slate-100">
            <script src="https://ads-partners.coupang.com/g.js"></script>
            <script>
                new PartnersCoupang.G({
                    "id": 961989,
                    "template": "carousel",
                    "trackingCode": "AF9667752",
                    "width": "100%",
                    "height": "140",
                    "tsource": ""
                });
            </script>
        </div>

         <!-- Disqus Comment Section -->
         <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 border-t border-slate-200">
            <h3 class="text-xl font-bold text-slate-900 mb-4"><i class="fa-regular fa-comments"></i> 방문자 후기</h3>
            <div id="disqus_thread"></div>
            <script>
                /**
                *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
                /*
                var disqus_config = function () {
                this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                };
                */
                (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');
                s.src = 'https://do-jjeon-coo.disqus.com/embed.js'; // 기본값으로 프로젝트명 넣음 (수정 필요할 수 있음)
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </section>
    </main>

    <footer class="bg-white border-t border-slate-200 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center text-slate-500 text-sm">
            <p>&copy; 2026 Do-Jjeon-Coo Project. All rights reserved.</p>
            <p class="mt-2">
                <a href="./privacy.html" class="hover:text-blue-600 underline">개인정보처리방침 (Privacy Policy)</a>
            </p>
        </div>
    </footer>

    <script>
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new kakao.maps.LatLng(37.4782, 126.9515), // 기본 위치 (관악구청 인근)
            level: 7
        };

        // 지도 생성
        var map = new kakao.maps.Map(mapContainer, mapOption);
        
        // 장소 검색 객체 생성
        var ps = new kakao.maps.services.Places(); 
        var infowindow = new kakao.maps.InfoWindow({zIndex:1});
        var markers = [];

        // 지역 데이터 (Original Data from index.jsp)
        var regionData = {
            '서울': ['관악구', '강남구', '서초구', '마포구', '송파구', '홍대'],
            '대구': ['수성구', '중구', '동구', '달서구', '북구', '서구', '남구', '달성군', '군위군']
        };

        function updateDistricts() {
            var citySelect = document.getElementById("citySelect");
            var districtSelect = document.getElementById("districtSelect");
            var selectedCity = citySelect.value;
            
            districtSelect.innerHTML = "";
            
            if (regionData[selectedCity]) {
                regionData[selectedCity].forEach(function(district) {
                    var option = document.createElement("option");
                    option.value = district;
                    option.text = district;
                    districtSelect.appendChild(option);
                });
            }
        }

        // 초기화
        window.onload = function() {
            updateDistricts();
            searchPlaces(); // 기본 지역(서울-관악구) 자동 검색
        };

        function searchPlaces() {
            var city = document.getElementById('citySelect').value;
            var district = document.getElementById('districtSelect').value;
            
            if (!city || !district) {
                alert('지역을 선택해주세요!');
                return;
            }

            // UI 업데이트
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('placeList').innerHTML = '';
            removeMarkers();

            // 키워드 검색 (예: "서울 관악구 두쫀쿠")
            var keyword = city + " " + district + " 두쫀쿠"; 

            ps.keywordSearch(keyword, placesSearchCB);
        }

        // 검색 완료 콜백
        function placesSearchCB(data, status, pagination) {
            document.getElementById('loading').classList.add('hidden');

            if (status === kakao.maps.services.Status.OK) {
                displayPlaces(data);
                displayPagination(pagination);
            } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                alert('검색 결과가 존재하지 않습니다.');
                return;
            } else if (status === kakao.maps.services.Status.ERROR) {
                alert('검색 중 오류가 발생했습니다.');
                return;
            }
        }

        function displayPlaces(places) {
            var listEl = document.getElementById('placeList');
            var bounds = new kakao.maps.LatLngBounds();

            document.getElementById('resultCount').innerText = places.length;

            for (var i=0; i<places.length; i++) {
                var place = places[i];
                var placePosition = new kakao.maps.LatLng(place.y, place.x);
                
                // 마커 생성
                var marker = addMarker(placePosition, i, place.place_name);
                bounds.extend(placePosition);

                // 리스트 아이템 생성
                var itemEl = document.createElement('div');
                itemEl.className = "bg-white p-4 rounded-lg shadow-sm border border-slate-100 hover:shadow-md transition cursor-pointer flex justify-between items-start group";
                itemEl.onclick = (function(m, p) {
                    return function() {
                        map.panTo(new kakao.maps.LatLng(p.y, p.x));
                        infowindow.setContent('<div style="padding:5px;font-size:12px;font-weight:bold;">' + p.place_name + '</div>');
                        infowindow.open(map, m);
                    }
                })(marker, place);

                itemEl.innerHTML = `
                    <div>
                        <h5 class="font-bold text-slate-800 text-lg mb-1 group-hover:text-blue-600 transition">
                            <a href="${place.place_url}" target="_blank" onclick="event.stopPropagation()" class="hover:underline">${place.place_name}</a>
                        </h5>
                        <p class="text-sm text-slate-500 mb-1">${place.road_address_name || place.address_name}</p>
                        <p class="text-xs text-blue-500">${place.category_name}</p>
                    </div>
                    <div class="text-right">
                        ${place.phone ? `<p class="text-sm text-slate-400"><i class="fa-solid fa-phone"></i> ${place.phone}</p>` : ''}
                        <a href="${place.place_url}" target="_blank" class="text-xs bg-slate-100 px-2 py-1 rounded text-slate-600 hover:bg-slate-200 mt-2 inline-block">상세보기</a>
                    </div>
                `;

                listEl.appendChild(itemEl);

                // [인피드 광고] 3번째 항목 뒤에 광고 배너 삽입 (모바일/PC 공용)
                if (i === 2) {
                    var adEl = document.createElement('div');
                    adEl.className = "my-4 text-center border-y border-slate-100 py-4 bg-slate-50";
                    
                    // 광고 스크립트 (모바일용 320x100 재활용)
                    // 주의: 동일 페이지에 같은 광고 단위가 여러 개 뜨면 정책상 하나만 보일 수 있으므로
                    // 여기서는 안전하게 '새로운 div'를 만들고 스크립트를 재실행하는 방식을 사용합니다.
                    // 실제 운영 시에는 '인피드 전용' 광고 단위를 별도로 파는 것이 가장 좋습니다.
                    // 현재는 테스트를 위해 기존 모바일 코드를 그대로 사용합니다.
                    
                    var adIns = document.createElement('ins');
                    adIns.className = 'kakao_ad_area';
                    adIns.style.display = 'none';
                    adIns.setAttribute('data-ad-unit', 'DAN-A3VyptE0YrQylD3y'); // 모바일용 ID 사용
                    adIns.setAttribute('data-ad-width', '320');
                    adIns.setAttribute('data-ad-height', '100');
                    
                    var adScript = document.createElement('script');
                    adScript.type = 'text/javascript';
                    adScript.src = '//t1.daumcdn.net/kas/static/ba.min.js';
                    adScript.async = true;

                    adEl.appendChild(adIns);
                    adEl.appendChild(adScript);
                    listEl.appendChild(adEl);
                }
            }

            // 지도 범위 재설정
            map.setBounds(bounds);
        }

        function addMarker(position, idx, title) {
            var marker = new kakao.maps.Marker({
                position: position,
                clickable: true
            });

            marker.setMap(map);
            markers.push(marker);

            kakao.maps.event.addListener(marker, 'click', function() {
                infowindow.setContent('<div style="padding:5px;font-size:12px;font-weight:bold;">' + title + '</div>');
                infowindow.open(map, marker);
            });

            return marker;
        }

        function removeMarkers() {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
            markers = [];
        }

        function displayPagination(pagination) {
            // 이번 버전에서는 단순화를 위해 페이지네이션 UI는 생략하고 1페이지만 보여줍니다.
            // 필요시 추가 가능
        }
    </script>
</body>
</html>
